%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Title

\defbeamertemplate*{title page}{crystalline}[1][]{%
  \nointerlineskip%
  \begin{beamercolorbox}[wd=\paperwidth, ht=\paperheight, sep = 0pt, dp = 0pt, #1]{%
      title,
      subtitle,
      date,
      institute,
      author,
      titlegraphic
    }
    \begin{tikzpicture}
      \useasboundingbox (0,0) rectangle(\paperwidth, \paperheight);

    \fill [
            color = normal_text_color,
          ] (0, 0.4\paperheight) rectangle(\paperwidth, 1.2\paperheight);


      \node[above right] at (1.15cm, 0.5em + 0.45\paperheight){%
      \begin{minipage}{\paperwidth-2cm}
            {\usebeamerfont{title}\usebeamercolor[fg]{title}\inserttitle\par}
      \end{minipage}
      };

      \node[above right] at (1.15cm, 0.5em + 0.33\paperheight){%
            {\usebeamerfont{subtitle}\usebeamercolor[fg]{subtitle}\insertsubtitle\par}%
      };


      \node[above right] at (1.15cm, 3.5em){%
              {\usebeamerfont{date}\usebeamercolor[fg]{date}\insertdate\par}
              {\usebeamerfont{institute}\usebeamercolor[fg]{institute}\insertinstitute\par}
                     {\usebeamerfont{author}\usebeamercolor[fg]{author}\insertauthor\par}
              \vspace{0.3em}
                };

      
    \end{tikzpicture}    
  \end{beamercolorbox}
}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% headline

\defbeamertemplate*{frametitle}{crystalline}[1][]{%
  \begin{beamercolorbox}[wd=\paperwidth, ht=1.2cm]{frametitle} 
    \begin{tikzpicture}
      \useasboundingbox (0, -1pt) rectangle(\paperwidth,\paperheight);

      \fill [color = normal_text_color] (0, 0pt) rectangle(\paperwidth, 1.3cm);
      
      \node[right] at (0.3, 0.6cm){
        \color{frametitle.fg}
        \insertframetitle
      };

      
      \node[above left, font=\large] at (\paperwidth+0.1cm, 0.2cm){
        \usebeamercolor[fg]{page number in head/foot}%
        \usebeamerfont{page number in head/foot}%
        \insertpagenumber%
        \footnotesize/\inserttotalframenumber
      };
       
    \end{tikzpicture}
  \end{beamercolorbox}
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% footline

\makeatletter
\def\progressbar@progressbar{}  % the progress bar
\newcount\progressbar@tmpcounta % auxiliary counter
\newcount\progressbar@tmpcountb % auxiliary counter
\newdimen\progressbar@pbht      %progressbar height
\newdimen\progressbar@pbwd      %progressbar width
\newdimen\progressbar@tmpdim    % auxiliary dimension

\progressbar@pbwd = \paperwidth
\progressbar@pbht = 3pt

% the progress bar
\def\progressbar@progressbar{%
  \progressbar@tmpcounta=\insertframenumber
  \progressbar@tmpcountb=\inserttotalframenumber
  \progressbar@tmpdim=\progressbar@pbwd
  \divide\progressbar@tmpdim by 100
  \multiply\progressbar@tmpdim by \progressbar@tmpcounta
  \divide\progressbar@tmpdim by \progressbar@tmpcountb
  \multiply\progressbar@tmpdim by 100

  \begin{tikzpicture}
    \fill[color = background_color]
    (0pt, 0pt) rectangle ++ (\progressbar@pbwd, \progressbar@pbht);

    \usebeamercolor{footline}
    \fill [color = footline.fg] 
    (0pt, 0pt) rectangle ++ (\progressbar@tmpdim, \progressbar@pbht);
  \end{tikzpicture}%
}

\setbeamertemplate{footline}{%
  \ifnum\theframenumber=1%
  % This is the titleYou can't use `\prevdepth' in horizontal mode frame, do nothing
  \else
  \begin{beamercolorbox}[wd=\paperwidth, ht=1cm]{page number in head/foot} 
    \begin{tikzpicture}
      \useasboundingbox (0,0) rectangle(\paperwidth,\paperheight);

      % the progress bar
      \progressbar@progressbar%
      
    \end{tikzpicture}
  \end{beamercolorbox}
  \fi
}

\setbeamertemplate{background}{
  \begin{tikzpicture}
    \useasboundingbox (0, 0) rectangle(\paperwidth,\paperheight);  
    \fill[color = background_color, opacity = 1]
    (0, 0) rectangle(\paperwidth,\paperheight + 5cm);
  \end{tikzpicture}
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Section

\setbeamertemplate{section in toc}[sections numbered]
\setbeamertemplate{subsection in toc}[subsections numbered]
\setbeamertemplate{section in toc shaded}[default][50]

